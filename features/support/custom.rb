#since the env.rb file is autogenerated, I'm adding my own stuff here.

#@driver_name = ENV['DRIVER'] || "poltergeist"
#Capybara.javascript_driver = @driver_name.to_sym
#Capybara.app_host = ENV['HOST'] || "http://x:x"

require 'rspec' #for page.shoud etc
require 'capybara/cucumber'
require 'capybara/poltergeist'
require 'pry'
require 'capybara-screenshot'
require 'capybara-screenshot/cucumber'
#require 'firefox'


#for email tests
require 'email_spec' # add this line if you use spork
require 'email_spec/cucumber'

#Capybara.register_driver :chrome do |app|
#  Capybara::Selenium::Driver.new(app, :browser => :chrome)
#end

require "selenium/webdriver"


# Clean the database before and after each scenario
Before do
  DatabaseCleaner.start
end

After do |scenario|
  DatabaseCleaner.clean
end

Capybara.register_driver :firefox do |app|
  	Capybara::Selenium::Driver.new(app, :browser=>:firefox)

  	# Selenium::WebDriver::Firefox::Binary.path = ENV['CUSTOM_FF_PATH'] if ENV['CUSTOM_FF_PATH'].present?
	profile = Selenium::WebDriver::Firefox::Profile.new
	# profile.assume_untrusted_certificate_issuer = ENV['SKIP_CERT_ISSUER'].present?
	profile['browser.download.dir'] = Rails.root.join("tmp/downloads").to_s
	profile['browser.download.folderList'] = 2 # implies custom location
	#profile['browser.helperApps.neverAsk.saveToDisk'] = "*"
	profile['browser.helperApps.neverAsk.saveToDisk'] = "text/csv,application/pdf,application/doc,application/docx,image/jpeg"
	profile.native_events = true
	Capybara::Selenium::Driver.new(app, :browser => :firefox ,:profile => profile)
	   #Capybara::Selenium::Driver.new app, :profile => profile
end

Capybara.register_driver :chrome do |app|
  #profile = Selenium::WebDriver::Chrome::Profile.new
  #profile["download.default_directory"] = DownloadHelpers::PATH.to_s
  #profile["download.default_directory"] = Rails.root.join("tmp/downloads")
  #Capybara::Selenium::Driver.new(app, :browser => :chrome, :profile => profile)
  Capybara::Selenium::Driver.new(app, :browser => :chrome)
end

#Capybara.server_port = 8910


# https://hub.docker.com/r/wernight/phantomjs/
#Capybara.default_driver = :poltergeist
Capybara.register_driver :poltergeist do |app|
    options = {
        :js_errors => true,
        #:port => 8910,
        #:host => 'pjs',
        :timeout => 120,
        :debug => false,
        :phantomjs_options => ['--load-images=no', '--disk-cache=false'],
        :inspector => true,
    }
    Capybara::Poltergeist::Driver.new(app, options)
end


Capybara.javascript_driver = :poltergeist

#"wait" for items to be pesent when using "first" method
Capybara.wait_on_first_by_default = true
Capybara.default_max_wait_time = 2

#Capybara.default_driver = :chrome
#Capybara.javascript_driver = :firefox

=begin
Capybara.register_driver :chrome do |app|
  profile = Selenium::WebDriver::Chrome::Profile.new
  #profile["download.default_directory"] = DownloadHelpers::PATH.to_s
  profile["download.default_directory"] = Rails.root.join("tmp/downloads")
  Capybara::Selenium::Driver.new(app, :browser => :chrome, :profile => profile)
end

Capybara.server_port = 1337

Capybara.default_driver = Capybara.javascript_driver = :chrome
Capybara.app_host = "http://localhost:" + Capybara.server_port.to_s
=end

#Capybara.default_driver = :chrome

#Capybara.default_driver = ENV['WEB_DRIVER'] || :selenium
#Capybara.javascript_driver = :selenium
Capybara.default_max_wait_time = 10
